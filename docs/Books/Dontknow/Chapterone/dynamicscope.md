# 第2章对比附录动态作用域

```
词法作用域是一套关于引擎如何寻找变量以及会在何处找到变量的规则。词法作用域最重要的特征是它的定义过程发生在代码的书写阶段（假设你没有使用eval() 或 with）。
动态作用域似乎暗示有很好的理由让作用域作为一个在运行时就被动态确定的形式，而不是在写代码时进行静态确定的形式，事实上也是这样的。我们通过示例代码来说明：
```

```js
function foo() {
  console.log(a); // 2
}

function bar() {
  var a = 3;
  foo();
}
var a = 2;
bar();
```

```
词法作用域让 foo() 中的 a 通过 RHS 引用到了全局作用域中的 a，因此会输出 2。
而动态作用域并不关心函数和作用域是如何声明以及在何处声明的，只关心它们从何处调用。换句话说，作用域链是基于调用栈的，而不是代码中的作用域嵌套。 
因此，如果 JavaScript 具有动态作用域，理论上，下面代码中的 foo() 在执行时将会输出 3 
```

```js
function foo() {
  console.log(a); // 3（不是 2 ！）
}

function bar() {
  var a = 3;
  foo();
}
var a = 2;
bar();
```

```
因为当 foo() 无法找到 a 的变量引用时，会顺着调用栈(全局调用bar()进栈，bar()中调用foo()进栈，foo()中查询a,出栈查询，bar()先出栈，全局后出栈，因此先在bar()作用域中查询)在调用 foo() 的地方查找 a，而不是在嵌套的词法作用域链中向上查找。由于 foo() 是在 bar() 中调用的，引擎会检查 bar() 的作用域，并在其中找到值为 3 的变量 a。
```

```
词法作用域是在写代码或者说定义时确定的，而动态作用域是在运行时确定的。（this 也是！）词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。
```
